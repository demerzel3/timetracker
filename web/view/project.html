<div project-controller>

  <div class="row navigation" ng-if="ctrl.project != null">
    <div class="col-md-4">
      <a href="#/"><i class="fa fa-angle-left"></i> Projects</a>
    </div>
    <div class="col-md-4 text-center">
      {{ctrl.project.name}}
    </div>
  </div>

  <div class="row">
    <div class="col-md-3" ng-if="ctrl.project != null">
      <div class="list-group tasks-list">
        <div ng-repeat="task in ctrl.project.tasks" 
           ng-class="{'active': ctrl.selectedTask == task}" 
           ng-click="ctrl.selectTask(task)" class="list-group-item" draggable="true">
          <strong>{{$index+1}})</strong> {{task.name}} {{task.estimate|floor}} <span class="badge">{{task.score|floor}}</span>
          <div nf-if="ctrl.selectedTask == task" style="float: right">
            <a href="" style="color: white"><i class="fa fa-pencil"></i></a>
            <a href="" style="color: white" ng-click="ctrl.deleteTask(task)"><i class="fa fa-times"></i></a>
          </div>
        </div>
        <div class="list-group-item">
          <form name="newTaskForm" class="form-horizontal" role="form" ng-submit="ctrl.createNewTask()">
            <div class="form-group">
              <div class="col-sm-12">
                <input id="newTaskInput" class="form-control" type="text" ng-model="ctrl.newTask.name" placeholder="New Task" ng-focus="ctrl.newTaskFormFocus = true" ng-blur="ctrl.newTaskFormFocus = false" />
              </div>
            </div>
            <div ng-if="ctrl.newTaskFormFocus || ctrl.newTask.name.length > 0">
              <div class="form-group">
                <label class="col-sm-7 control-label" for="newTaskScoreBox">Score</label>
                <div class="col-sm-5">
                  <input type="number" class="form-control" id="newTaskScoreBox" ng-model="ctrl.newTask.score" placeholder="eg 3"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-7 control-label" for="newTaskEstimateBox">Est. Duration (h)</label>
                <div class="col-sm-5">
                  <input type="number" class="form-control" id="newTaskEstimateBox" ng-model="ctrl.newTask.estimate" placeholder="eg 16"/>
                </div>
              </div>
              <div class="form-group">
                <div class="col-sm-offset-7 col-sm-5">         
                  <button type="submit" class="btn btn-default"> <i class="fa fa-plus"></i> Add</button>
                </div>
              </div>
            </div>            
          </form>
        </div>
      </div>
      <div ng-if="ctrl.project.deletedTasks.length > 0">
        <a href="" ng-click="ctrl.showTasksBin()"><i class="fa fa-trash-o"></i> {{ctrl.project.deletedTasks.length}}</a>
        <button class="btn btn-default btn-xs" ng-click="ctrl.clearDeletedTasks()">Empty Bin</button>
      </div>
    </div>

    <div class="col-md-6" ng-if="ctrl.selectedTask != null">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Data</th>
            <th>Persona</th>
            <th>Durata (h)</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="timing in ctrl.selectedTask.timings">
            <td>{{timing.date|date:'dd/MM/yyyy'}}</td>
            <td>{{timing.user.name}}</td>
            <td>{{timing.duration|duration:'hh:mm'}}</td>
          </tr>
          
          <tr>
            <td colspan="3">
              <form role="form" class="form-inline" ng-submit="ctrl.createNewTiming()">
                <div class="form-group">
                  <input type="date" class="form-control" id="dateBox" size="10" 
                    ng-model="ctrl.newTiming.date" required>  
                </div>
                <div class="form-group">
                  <select id="userBox" class="form-control" ng-model="ctrl.newTiming.user" required>
                    <option disabled selected value="">Scegli...</option>
                    <option ng-repeat="user in ctrl.users" ng-value="user">{{user.name}}</option>
                  </select>
                </div>
                <div class="form-group">
                  <input type="time" id="durationBox" 
                    class="form-control" ng-model="ctrl.newTiming.duration" placeholder="HH:MM" size="5" required>
                </div>
                <div class="form-group">
                  <button type="submit" class="btn btn-default"><i class="fa fa-plus"></i> Aggiungi</button>
                </div>          
              </form>        
            </td>
          </tr>
          
        </tbody>
      </table>   
      date: {{ctrl.newTiming.date}}, duration: {{ctrl.newTiming.duration}}, user: {{ctrl.newTiming.user}}
    </div>

  </div>
  
  <!-- Modal -->
  <div class="modal fade" id="tasksBinModal" tabindex="-1" role="dialog" aria-labelledby="tasksBinModal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="myModalLabel">Deleted Tasks</h4>
        </div>
        <div class="modal-body">
          <ul>
            <li ng-repeat="task in ctrl.project.deletedTasks">
              {{task.name}} <a href="" ng-click="ctrl.restoreTask(task)">Restore</a>
            </li>
          </ul>
        </div>
        <!--
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
        -->
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

</div>
